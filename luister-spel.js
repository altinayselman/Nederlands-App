const audioExercises = {
    level1: {
        name: 'Niveau 1',
        sentences: [
            { text: "Hallo, hoe gaat het?", english: "Hello, how are you?" },
            { text: "Ik ben een student.", english: "I am a student." },
            { text: "Het weer is mooi vandaag.", english: "The weather is nice today." },
            { text: "Ik woon in Nederland.", english: "I live in the Netherlands." },
            { text: "Dit is mijn eerste les.", english: "This is my first lesson." },
            { text: "Goedemorgen, hoe gaat het met je?", english: "Good morning, how are you?" },
            { text: "Ik heet Anna.", english: "My name is Anna." },
            { text: "Waar kom je vandaan?", english: "Where are you from?" },
            { text: "Ik kom uit Turkije.", english: "I am from Turkey." },
            { text: "Spreek je Nederlands?", english: "Do you speak Dutch?" },
            { text: "Ik spreek een beetje Nederlands.", english: "I speak a little Dutch." },
            { text: "Wat is je telefoonnummer?", english: "What is your phone number?" },
            { text: "Hoe oud ben je?", english: "How old are you?" },
            { text: "Ik ben twintig jaar oud.", english: "I am twenty years old." },
            { text: "Waar woon je?", english: "Where do you live?" },
            { text: "Ik woon in Amsterdam.", english: "I live in Amsterdam." },
            { text: "Wat is je adres?", english: "What is your address?" },
            { text: "Heb je broers of zussen?", english: "Do you have brothers or sisters?" },
            { text: "Ik heb één broer en één zus.", english: "I have one brother and one sister." },
            { text: "Wat is je favoriete kleur?", english: "What is your favorite color?" },
            { text: "Mijn favoriete kleur is blauw.", english: "My favorite color is blue." },
            { text: "Wat is je hobby?", english: "What is your hobby?" },
            { text: "Ik hou van muziek.", english: "I love music." },
            { text: "Wat doe je in je vrije tijd?", english: "What do you do in your free time?" },
            { text: "Ik lees graag boeken.", english: "I like reading books." },
            { text: "Hoe laat is het?", english: "What time is it?" },
            { text: "Het is drie uur.", english: "It is three o'clock." },
            { text: "Welke dag is het vandaag?", english: "What day is it today?" },
            { text: "Het is maandag.", english: "It is Monday." },
            { text: "Wat is de datum?", english: "What is the date?" },
            { text: "Het is tien mei.", english: "It is May tenth." },
            { text: "Wat eet je voor ontbijt?", english: "What do you eat for breakfast?" },
            { text: "Ik drink koffie met melk.", english: "I drink coffee with milk." },
            { text: "Hoe gaat het met je familie?", english: "How is your family?" },
            { text: "Met mijn familie gaat het goed.", english: "My family is doing well." },
            { text: "Wat is je lievelingseten?", english: "What is your favorite food?" },
            { text: "Ik hou van pizza.", english: "I love pizza." },
            { text: "Heb je huisdieren?", english: "Do you have pets?" },
            { text: "Ik heb een kat.", english: "I have a cat." },
            { text: "Wat voor weer is het?", english: "What's the weather like?" },
            { text: "Het regent vandaag.", english: "It's raining today." },
            { text: "Waar werk je?", english: "Where do you work?" },
            { text: "Ik werk in een kantoor.", english: "I work in an office." },
            { text: "Wat studeer je?", english: "What do you study?" },
            { text: "Ik studeer Nederlands.", english: "I study Dutch." },
            { text: "Hoe ga je naar school?", english: "How do you go to school?" },
            { text: "Ik ga met de fiets.", english: "I go by bike." },
            { text: "Wat ga je dit weekend doen?", english: "What are you going to do this weekend?" },
            { text: "Ik ga naar het park.", english: "I am going to the park." },
            { text: "Ken je de weg naar het station?", english: "Do you know the way to the station?" },
            { text: "Het station is daar.", english: "The station is there." }
        ]
    },
    level2: {
        name: 'Niveau 2',
        sentences: [
            { text: "Wat doe je in je vrije tijd?", english: "What do you do in your free time?" },
            { text: "Ik spreek een beetje Nederlands.", english: "I speak a little Dutch." },
            { text: "Kun je dat herhalen alsjeblieft?", english: "Can you repeat that please?" },
            { text: "Ik ga naar de supermarkt.", english: "I am going to the supermarket." },
            { text: "Het is half drie in de middag.", english: "It is half past two in the afternoon." },
            { text: "Kunt u mij de weg wijzen naar het museum?", english: "Can you show me the way to the museum?" },
            { text: "Ik heb een afspraak met de dokter.", english: "I have an appointment with the doctor." },
            { text: "Wat zijn je plannen voor de vakantie?", english: "What are your plans for the vacation?" },
            { text: "Ik werk als software ontwikkelaar.", english: "I work as a software developer." },
            { text: "Hoe lang woon je al in Nederland?", english: "How long have you been living in the Netherlands?" },
            { text: "Ik zoek een nieuwe baan.", english: "I am looking for a new job." },
            { text: "Wat zijn je sterke punten?", english: "What are your strengths?" },
            { text: "Ik ben goed in probleemoplossing.", english: "I am good at problem solving." },
            { text: "Hoe was je weekend?", english: "How was your weekend?" },
            { text: "Ik ben naar een concert geweest.", english: "I went to a concert." },
            { text: "Wat vind je van Nederlandse cultuur?", english: "What do you think of Dutch culture?" },
            { text: "De Nederlandse cultuur is interessant.", english: "Dutch culture is interesting." },
            { text: "Heb je al gegeten?", english: "Have you eaten yet?" },
            { text: "Ik heb net lunch gehad.", english: "I just had lunch." },
            { text: "Waar kan ik een fiets huren?", english: "Where can I rent a bike?" },
            { text: "Wat zijn de openingstijden?", english: "What are the opening hours?" },
            { text: "Hoe lang duurt de reis?", english: "How long does the journey take?" },
            { text: "De reis duurt ongeveer een uur.", english: "The journey takes about an hour." },
            { text: "Wat is je ervaring met dit werk?", english: "What is your experience with this work?" },
            { text: "Ik heb vijf jaar ervaring.", english: "I have five years of experience." },
            { text: "Kun je in een team werken?", english: "Can you work in a team?" },
            { text: "Ik werk graag samen met anderen.", english: "I like working with others." },
            { text: "Wat zijn je hobby's?", english: "What are your hobbies?" },
            { text: "Ik hou van sporten en lezen.", english: "I like sports and reading." },
            { text: "Hoe vaak sport je?", english: "How often do you exercise?" },
            { text: "Ik sport drie keer per week.", english: "I exercise three times a week." },
            { text: "Wat is je favoriete sport?", english: "What is your favorite sport?" },
            { text: "Ik speel graag voetbal.", english: "I like playing football." },
            { text: "Hoe laat begin je met werken?", english: "What time do you start working?" },
            { text: "Ik begin om negen uur.", english: "I start at nine o'clock." },
            { text: "Wat zijn je werkuren?", english: "What are your working hours?" },
            { text: "Ik werk van negen tot vijf.", english: "I work from nine to five." },
            { text: "Heb je een rijbewijs?", english: "Do you have a driver's license?" },
            { text: "Ja, ik heb een rijbewijs.", english: "Yes, I have a driver's license." },
            { text: "Wat is je opleidingsniveau?", english: "What is your education level?" },
            { text: "Ik heb een universitair diploma.", english: "I have a university degree." },
            { text: "Spreek je andere talen?", english: "Do you speak other languages?" },
            { text: "Ik spreek Engels en Nederlands.", english: "I speak English and Dutch." },
            { text: "Wat zijn je toekomstplannen?", english: "What are your future plans?" },
            { text: "Ik wil mijn eigen bedrijf starten.", english: "I want to start my own business." },
            { text: "Hoe ga je naar je werk?", english: "How do you go to work?" },
            { text: "Ik neem de trein naar werk.", english: "I take the train to work." },
            { text: "Wat doe je in het weekend?", english: "What do you do on weekends?" },
            { text: "Ik breng tijd door met vrienden.", english: "I spend time with friends." },
            { text: "Hoe vaak ga je op vakantie?", english: "How often do you go on vacation?" },
            { text: "Ik ga twee keer per jaar.", english: "I go twice a year." }
        ]
    },
    level3: {
        name: 'Niveau 3',
        sentences: [
            { text: "Nederlands leren is heel interessant maar ook uitdagend.", english: "Learning Dutch is very interesting but also challenging." },
            { text: "Volgende week ga ik op vakantie naar Amsterdam.", english: "Next week I am going on vacation to Amsterdam." },
            { text: "Zou je me kunnen helpen met deze oefening?", english: "Could you help me with this exercise?" },
            { text: "De Nederlandse cultuur is heel verschillend van de mijne.", english: "Dutch culture is very different from mine." },
            { text: "Ik heb een afspraak met de dokter gemaakt.", english: "I made an appointment with the doctor." },
            { text: "De klimaatverandering heeft grote invloed op ons dagelijks leven.", english: "Climate change has a big impact on our daily lives." },
            { text: "We moeten duurzame oplossingen vinden voor milieuproblemen.", english: "We need to find sustainable solutions for environmental problems." },
            { text: "De digitalisering verandert de manier waarop we werken.", english: "Digitalization is changing the way we work." },
            { text: "Kunstmatige intelligentie speelt een steeds belangrijkere rol.", english: "Artificial intelligence plays an increasingly important role." },
            { text: "Het is belangrijk om een goede werk-privébalans te hebben.", english: "It's important to have a good work-life balance." },
            { text: "De economische situatie heeft invloed op de arbeidsmarkt.", english: "The economic situation affects the job market." },
            { text: "We moeten investeren in hernieuwbare energiebronnen.", english: "We need to invest in renewable energy sources." },
            { text: "Cyberveiligheid is een groeiende uitdaging voor bedrijven.", english: "Cybersecurity is a growing challenge for companies." },
            { text: "Innovatie is essentieel voor economische groei.", english: "Innovation is essential for economic growth." },
            { text: "Het onderwijs moet zich aanpassen aan de digitale revolutie.", english: "Education must adapt to the digital revolution." },
            { text: "De gezondheidszorg staat voor grote uitdagingen.", english: "Healthcare faces major challenges." },
            { text: "Diversiteit op de werkvloer is zeer belangrijk.", english: "Diversity in the workplace is very important." },
            { text: "We moeten de biodiversiteit beschermen.", english: "We need to protect biodiversity." },
            { text: "Duurzame ontwikkeling is een prioriteit.", english: "Sustainable development is a priority." },
            { text: "De vergrijzing heeft impact op de samenleving.", english: "Aging population has an impact on society." },
            { text: "We moeten investeren in infrastructuur.", english: "We need to invest in infrastructure." },
            { text: "Sociale media beïnvloeden ons dagelijks leven.", english: "Social media influence our daily lives." },
            { text: "Onderzoek en ontwikkeling zijn cruciaal.", english: "Research and development are crucial." },
            { text: "We moeten de culturele diversiteit respecteren.", english: "We must respect cultural diversity." },
            { text: "De globalisering biedt kansen en uitdagingen.", english: "Globalization offers opportunities and challenges." },
            { text: "Levenslang leren wordt steeds belangrijker.", english: "Lifelong learning is becoming increasingly important." },
            { text: "We moeten de mensenrechten beschermen.", english: "We must protect human rights." },
            { text: "De digitale transformatie versnelt.", english: "Digital transformation is accelerating." },
            { text: "Duurzaam ondernemen is de toekomst.", english: "Sustainable business is the future." },
            { text: "We moeten de sociale cohesie versterken.", english: "We need to strengthen social cohesion." },
            { text: "De arbeidsmarkt verandert snel.", english: "The job market is changing rapidly." },
            { text: "Innovatieve oplossingen zijn nodig.", english: "Innovative solutions are needed." },
            { text: "We moeten de natuurlijke hulpbronnen beschermen.", english: "We must protect natural resources." },
            { text: "De technologische vooruitgang is onstopbaar.", english: "Technological progress is unstoppable." },
            { text: "Internationale samenwerking is essentieel.", english: "International cooperation is essential." },
            { text: "We moeten de economie verduurzamen.", english: "We need to make the economy more sustainable." },
            { text: "De energietransitie is een grote uitdaging.", english: "The energy transition is a major challenge." },
            { text: "Digitale vaardigheden zijn onmisbaar.", english: "Digital skills are indispensable." },
            { text: "We moeten de sociale ongelijkheid aanpakken.", english: "We need to address social inequality." },
            { text: "De circulaire economie biedt kansen.", english: "The circular economy offers opportunities." },
            { text: "Klimaatadaptatie is noodzakelijk.", english: "Climate adaptation is necessary." },
            { text: "We moeten de democratie versterken.", english: "We need to strengthen democracy." },
            { text: "De rol van technologie neemt toe.", english: "The role of technology is increasing." },
            { text: "Duurzame mobiliteit is de toekomst.", english: "Sustainable mobility is the future." },
            { text: "We moeten de biodiversiteit herstellen.", english: "We need to restore biodiversity." },
            { text: "De digitale economie groeit snel.", english: "The digital economy is growing rapidly." },
            { text: "Sociale innovatie is belangrijk.", english: "Social innovation is important." },
            { text: "We moeten de klimaatdoelen halen.", english: "We need to achieve climate goals." },
            { text: "De arbeidsmarkt wordt flexibeler.", english: "The job market is becoming more flexible." },
            { text: "Duurzame landbouw is essentieel.", english: "Sustainable agriculture is essential." },
            { text: "We moeten de waterkwaliteit verbeteren.", english: "We need to improve water quality." },
            { text: "De digitale kloof moet worden gedicht.", english: "The digital divide must be bridged." },
            { text: "Circulair bouwen is de norm.", english: "Circular construction is the norm." },
            { text: "We moeten de luchtkwaliteit verbeteren.", english: "We need to improve air quality." }
        ]
    }
};

let currentLevel = 'level1';
let currentSentenceIndex = 0;
let score = 0;
let playsLeft = 2;
let sentences = [];

function initGame() {
    createLevelSelector();
    resetGame();
}

function createLevelSelector() {
    const container = document.getElementById('level-container');
    container.innerHTML = `
        <div class="form-group">
            <label for="level-select" class="form-label">Kies een niveau:</label>
            <select class="form-select" id="level-select" onchange="changeLevel(this.value)">
                ${Object.entries(audioExercises).map(([key, level]) => 
                    `<option value="${key}">${level.name}</option>`
                ).join('')}
            </select>
        </div>
    `;
}

function changeLevel(newLevel) {
    currentLevel = newLevel;
    resetGame();
}

function resetGame() {
    currentSentenceIndex = 0;
    score = 0;
    sentences = [...audioExercises[currentLevel].sentences];
    shuffleSentences();
    updateUI();
    resetPlayButton();
}

function shuffleSentences() {
    for (let i = sentences.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [sentences[i], sentences[j]] = [sentences[j], sentences[i]];
    }
}

function updateUI() {
    document.getElementById('score').textContent = score;
    document.getElementById('current-level').textContent = currentLevel.replace('level', '');
    document.getElementById('plays-left').textContent = playsLeft;
    
    const progress = (currentSentenceIndex / sentences.length) * 100;
    document.getElementById('progress-bar').style.width = `${progress}%`;
    
    document.getElementById('game').style.display = 'block';
    document.getElementById('game-over').style.display = 'none';
}

function resetPlayButton() {
    playsLeft = 2;
    document.getElementById('plays-left').textContent = playsLeft;
    document.getElementById('play-button').disabled = false;
}

function playCurrentSentence() {
    if (playsLeft > 0 && currentSentenceIndex < sentences.length) {
        const utterance = new SpeechSynthesisUtterance(sentences[currentSentenceIndex].text);
        utterance.lang = 'nl-NL';
        utterance.rate = 0.9; // Biraz yavaş konuşma hızı
        window.speechSynthesis.speak(utterance);
        
        playsLeft--;
        document.getElementById('plays-left').textContent = playsLeft;
        
        if (playsLeft === 0) {
            document.getElementById('play-button').disabled = true;
        }
    }
}

function checkAnswer() {
    const userAnswer = document.getElementById('answer').value.toLowerCase().trim();
    const currentSentence = sentences[currentSentenceIndex];
    
    if (userAnswer === currentSentence.text.toLowerCase()) {
        const points = calculatePoints();
        score += points;
        showFeedback(true, points);
    } else {
        showFeedback(false, currentSentence.text);
    }
    
    currentSentenceIndex++;
    updateUI();
    
    if (currentSentenceIndex < sentences.length) {
        setTimeout(() => {
            resetPlayButton();
            document.getElementById('answer').value = '';
            document.getElementById('answer').focus();
        }, 1500);
    } else {
        endGame();
    }
}

function calculatePoints() {
    const basePoints = {
        level1: 10,
        level2: 15,
        level3: 20
    };
    
    let points = basePoints[currentLevel];
    if (playsLeft > 0) points += playsLeft * 5; // Bonus for fewer plays
    return points;
}

function showFeedback(isCorrect, extra) {
    const feedbackContainer = document.getElementById('feedback-container');
    const feedbackClass = isCorrect ? 'alert-success' : 'alert-danger';
    let feedbackMessage = isCorrect ? 
        `✅ Correct! +${extra} punten` : 
        `❌ Onjuist! Juiste antwoord: "${extra}"`;
    
    feedbackContainer.innerHTML = `
        <div class="alert ${feedbackClass} mt-3">
            ${feedbackMessage}
        </div>
    `;
    
    setTimeout(() => {
        feedbackContainer.innerHTML = '';
    }, 1500);
}

function endGame() {
    document.getElementById('game').style.display = 'none';
    document.getElementById('game-over').style.display = 'block';
    document.getElementById('final-score').textContent = score;
    document.getElementById('final-level').textContent = currentLevel.replace('level', '');
}

function restartGame() {
    // Oyun durumunu sıfırla
    currentSentenceIndex = 0;
    score = 0;
    playsLeft = 2;
    
    // Cümleleri yeniden karıştır
    sentences = [...audioExercises[currentLevel].sentences];
    shuffleSentences();
    
    // Arayüzü güncelle
    document.getElementById('game').style.display = 'block';
    document.getElementById('game-over').style.display = 'none';
    document.getElementById('score').textContent = '0';
    document.getElementById('current-level').textContent = currentLevel.replace('level', '');
    document.getElementById('plays-left').textContent = '2';
    document.getElementById('progress-bar').style.width = '0%';
    
    // İlk cümleyi göster
    showNextWord();
    
    // Play butonunu aktif hale getir
    document.getElementById('play-button').disabled = false;
    
    // Input alanını temizle
    document.getElementById('answer').value = '';
    document.getElementById('answer').focus();
}

document.getElementById('play-button').addEventListener('click', playCurrentSentence);

document.getElementById('answer').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        checkAnswer();
    }
});

initGame(); 